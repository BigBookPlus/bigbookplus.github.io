---
title: "使用POCO库进行FTP操作"
description: "POCO是一个为C++用户设计的轻量级且灵活的网络库。"
date: 2022-06-15
lang: zh
slug: "poco-ftp"
tags: ["FTP", "poco", "C-Cpp"]
featured: false
draft: false
---

## POCO
POCO是一个为C++用户设计的轻量级且灵活的网络库。
您可以在其主页：https://pocoproject.org/ 或其github项目页面：https://github.com/pocoproject/poco 查看POCO库。
您可以简单地从POCO仓库git clone，并按照其官方手册构建。
对我而言，我只是在Windows上使用CMake-GUI工具，使用所有默认设置构建它。

## 如何上传

### 包含头文件
大多数FTP相关的API都在`Poco/Net/FTPClientSession.h`头文件中。异常处理工具一直在使用，所以我们也包含它。当您需要上传到FTP服务器时，必须包含`Poco/StreamCopier.h`。

```cpp
#include "Poco/Net/FTPClientSession.h"
#include "Poco/Net/NetException.h"
#include "Poco/StreamCopier.h"
```

StreamCopier需要std流，所以我们也包含它们。

```cpp
#include <iostream>
#include <fstream>
```

### 创建对象

```cpp
auto* ftp = new Poco::Net::FTPClientSession("192.168.1.3", 21, "username", "password");
```

### 执行上传


```cpp
try{
    std::ostream &ftpOStream = ftp->beginUpload("target_file_name.png");
    std::ifstream localIFStream("/path/to/local_file.png", std::ifstream::in | std::ifstream::binary);
    auto numBytes = Poco::StreamCopier::copyStream(localIFStream, ftpOStream);
    ftp->endUpload();
}
catch( Poco::Net::FTPException& e)
{
    std::cerr<<e.what()<<e.message()<<std::endl;
}
```
